var mtfFrame=function(){var v,css=function(a,b){for(var c in b)a.style[c]=b[c]},c=function(a){return document.createElement(a)},id2o=function(a){return document.getElementById(a)},BE=function(a,b){return a&&"undefined"!=typeof a[b]},option={refresh:"松开刷新 Loose to Refresh",mtfp2p:"https://p.yot.pw",mtfp2psso:"https://p.24zhifu.store",mtf:"https://mtf.yzhan.nl",openWin:"http://cdn.dm126.com/share/mtfOpenWin.html?v=1.004",menu:{"菜单<sup></sup>":"",DM126:"http://app.yzhan.in","导航":"http://hao.yzhan.nl","动态<sup></sup>":"https://p.yot.pw","我<sup></sup>":"https://p.yot.pw/?mtfa=me"},color:"#fb4a6f",cdn:"//cdn.dm126.com/share",web:"//app.yzhan.in"},set=function(a){var b,c;for(b in a)if("object"==typeof a[b])for(c in a[b])option[b][c]=a[b][c];else option[b]=a[b]},refresh=function(a){if(BE(window,"addEventListener")){var f,g,b="MTFrefresh",d=a?a:document.body,e=function(){return d.scrollTop||document.documentElement.scrollTop},h=function(){id2o(b)&&document.body.removeChild(id2o(b))};document.body.addEventListener("touchstart",function(a){if(0===e()){var b=a.targetTouches[0];f=b.pageY}},!1),document.body.addEventListener("touchmove",function(a){var d,i,j;0===e()?(d=a.targetTouches[0],g=d.pageY,i=g-f,i>90?id2o(b)||(j=c("DIV"),j.id=b,css(j,{position:"fixed",top:"0",textAlign:"center",zIndex:"99999",background:option.color,color:"white",width:"100%",lineHeight:"2em",textShadow:"none"}),j.innerHTML=option.refresh,document.body.appendChild(j)):h()):h()},!1),document.body.addEventListener("touchend",function(){if(0===e()){var b=g-f;b>90&&location.reload()}else g=0;h()},!1)}},sup=function(a,b){css(a,{color:"white",background:"red",padding:"1px 3px",borderRadius:"3px"}),a.innerHTML=b},msg=function(a,b,c){var e,f,d=document.getElementById("MTFmenu").getElementsByTagName("sup");for(f=0;f<d.length;f++)e=0===f?c:1===f?b:a,parseInt(e)>0&&sup(d[f],e)},menu=function(){var f,g,h,i,a=option.menu,b=c("DIV"),d=-1,e="MTFmenu";css(b,{position:"fixed",bottom:"0",left:"0",width:"100%",textShadow:"none",lineHeight:"2em"}),b.id=e,f=function(){setTimeout(function(){var b,a=id2o(e).getElementsByTagName("SPAN");for(b=0;b<a.length;b++)css(a[b],{display:"none"});css(a[0],{display:"inline-block"})},6e3)};for(g in a)d++;h=100*(1/d)+"%",d=0;for(g in a)i=c("SPAN"),css(i,{background:"white",cursor:"pointer",textAlign:"center",borderRadius:"3px 3px 0 0",fontSize:"14px"}),0===d?(g+=" >",css(i,{display:"none",opacity:"0.6",textIndent:"10px"}),i.onclick=function(){var b,a=this.parentNode.getElementsByTagName("SPAN");for(b=0;b<a.length;b++)css(a[b],{display:"inline-block"});css(this,{display:"none"}),f()}):(i.setAttribute("href",a[g]),i.onclick=function(){top.location.href=this.getAttribute("href"),setTimeout(function(){top.location.reload()},1100)},a[g].replace(option.mtfp2p,option.mtf)===window.location.href.replace("appin/","")&&css(i,{background:option.color,color:"white"}),css(i,{width:h,display:"inline-block"})),i.innerHTML=g,b.appendChild(i),d++;document.body.appendChild(b),f()},pm=function(){ajax.get(option.web+"/api.php?a=pm",function(r){if(r){var j=eval("("+r+")");BE(j,"n")&&msg(j.n,j.n1,j.n+j.n1)}})},ps=function(a){var b,c,d,e;for(a||(a=window.location.hash.substr(1)),b={},c=("?"===a[0]?a.substr(1):a).split("&"),d=0;d<c.length;d++)e=c[d].split("="),b[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"");return b},sso=function(){var b,c,a=ps();return localStorage&&(BE(a,"uid")&&(localStorage.setItem("i",a.i),localStorage.setItem("uid",a.uid)),b=localStorage.getItem("i"),c=localStorage.getItem("uid")),{i:b,uid:c}},fc=function(){var a=ps();BE(a,"mtfFC")&&eval(a.mtfFC+"(a)")},js=function(a){var b=c("SCRIPT");b.type="text/javascript",b.src=a,document.body.appendChild(b)},sign={i:"mtfSign",step:0,j:function(a,b){js(option.mtf+"/api/file/list/?a=sign&step="+b+"&uid="+a+"&jsonp=mtfFrame.sign.show&r="+Math.random())},init:function(){var a=sso();a.i&&a.uid?sign.j(a.uid,0):sign.bt()},bt:function(){var a=c("DIV");css(a,{position:"absolute",top:"27px",right:"40px",color:"#fb4a6f",cursor:"pointer",textAlign:"center",borderRadius:"3px",fontSize:"14px",opacity:".8",padding:"0px 3px","text-shadow":"none",border:"1px solid #fb4a6f"}),window.navigator.standalone&&css(a,{top:"48px"}),a.innerHTML="签到<sup>双倍</sup>",a.id=sign.i,a.onclick=function(){var a=sso();sign.step=1,sign.j(a.uid,1)},document.body.appendChild(a)},show:function(a){var b,d,e,i,l,m,n,f,g,h,j,k,o,p,q;if(BE(a,"error"))b=a.error,"login-update"===b?localStorage&&(localStorage.setItem("uid",a.uid),sign.j(a.uid,0)):0===sign.step?sign.bt():(sign.step=0,d=confirm("请先登录，然后签到，每天领奖励哦。下拉刷新，弹出登录"),d&&(window.location.href=option.mtfp2psso+"/mod/SSO?r="+encodeURIComponent(window.location.href)));else if(BE(a,"step"))if(e=a.step,0===e)0===a.sign&&sign.bt();else if(1===e){for(f=c("DIV"),g=a.day,h=a.zan,j=3,k=(100/3).toFixed(2)-1.3+"%",o=function(a,b,d){var e=c("A");return e.innerHTML=a,css(e,{display:"inline-block",background:"#F7F7F7",color:"gray","text-decoration":"none",width:b,margin:"2px",cursor:"pointer"}),d&&(e.href=d,e.onclick=function(){return openWin(this.href,"",1),!1}),e},css(f,{position:"fixed",top:"30%",left:"50%",marginLeft:"-125px",width:"250px","text-align":"center",background:"white",opacity:".9","border-radius":"5px",border:"10px solid white","text-shadow":"none"}),p=c("SPAN"),p.innerHTML=a.i,css(p,{color:"#333333","font-weight":"bold"}),f.appendChild(p),f.innerHTML+=' 签到成功！<p style="color:red;font-size:2em">+ '+h+"❤</p>",q=1;j>=q;q++)i=c("DIV"),i.innerHTML=q+"天",g>=q?(m="pink",n="white"):(m="#F7F7F7",n="black"),css(i,{display:"inline-block",width:k,"line-height":"200%",background:m,color:n}),f.appendChild(i);f.innerHTML+="<p>连续签到"+j+"天，"+j+"倍奖励</p>",f.appendChild(o("赚 ❤","48.3%",option.mtfp2p+"/weal")),f.appendChild(o("花 ❤","48.3%",option.mtfp2p+"/100314")),n=o("点此关闭","98.6%"),f.appendChild(n),l=id2o(sign.i),l&&l.parentNode.removeChild(l),document.body.appendChild(f),n.onclick=function(){var a=this.parentNode;a.parentNode.removeChild(a)}}}},version=function(){return v},update=function(a){v=a;var b=c("SCRIPT");b.type="text/javascript",b.src=option.cdn+"/mtfVersion.js?r="+Math.random(),document.body.appendChild(b)},u2n=function(a,b){var c=document.createElement("A");return c.href=a,c.host?c.host.replace(/\./g,"_").replace(/\:/g,"_"):b},openWin=function(a,b,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,e=0;if("undefined"!=typeof api)e=1,api.openWin({name:u2n(a,"newW"),url:option.openWin,pageParam:{url:a},allowEdit:!0,progress:{type:"page"},reload:!0});else{if(e=-1,b&&(f=confirm(b),!f))return 0;if(window.navigator.standalone)g=c("A"),g.href=a,g.click();else if(d){for(h=c("IFRAME"),i=document.documentElement.clientHeight||document.body.clientHeight,h.src=a,css(h,{position:"fixed",top:"30px",left:0,width:"100%",height:i-30+"px",border:"none",background:"#FFFFFF"}),h.setAttribute("allowFullscreen",!0),h.setAttribute("allowTransparency",!0),h.setAttribute("frameborder",0),document.body.appendChild(h),j=c("DIV"),k=c("A"),l=c("A"),m=c("A"),css(j,{position:"fixed",top:"0",left:"0",width:"100%",background:"#F7F7F7",textAlign:"center"}),css(k,{"float":"left"}),css(l,{"float":"right"}),css(m,{"float":"right"}),k.innerHTML="X",l.innerHTML="＜",m.innerHTML="＞",j.appendChild(k),j.appendChild(m),j.appendChild(l),j.appendChild(m),document.body.appendChild(j),n=j.getElementsByTagName("A"),o=0;o<n.length;o++)css(n[o],{display:"block",width:"30px",lineHeight:"28px",cursor:"pointer",border:"1px solid #FFFFFF"});l.onclick=function(){history.back()},m.onclick=function(){history.forward()},p="",q=window.location.hash,r=null,k.onclick=function(){var a=this.parentNode;document.body.removeChild(a.previousSibling),document.body.removeChild(a),clearInterval(r),window.location.hash=""},r=setInterval(function(){var a=window.location.hash;"#f"===p&&a===q&&k.click(),p=a},1e3),window.location.hash="#f"}else window.open(a)}return e},longPress=function(){!function(a,b){"use strict";function c(){this.dispatchEvent(new CustomEvent("long-press",{bubbles:!0,cancelable:!0})),clearTimeout(d)}var d=null,e="ontouchstart"in a||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,f=e?"touchstart":"mousedown",g=e?"touchcancel":"mouseout",h=e?"touchend":"mouseup",i=e?"touchmove":"mousemove";"initCustomEvent"in b.createEvent("CustomEvent")&&(a.CustomEvent=function(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=b.createEvent("CustomEvent");return d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail),d},a.CustomEvent.prototype=a.Event.prototype),b.addEventListener(f,function(a){var b=a.target,e=parseInt(b.getAttribute("data-long-press-delay")||"1500",10);d=setTimeout(c.bind(b),e)}),b.addEventListener(h,function(){clearTimeout(d)}),b.addEventListener(g,function(){clearTimeout(d)}),b.addEventListener(i,function(){clearTimeout(d)})}(this,document)},longTouch={img:function(){var a,b;if("createTouch"in document)for(longPress(),a=document.getElementsByTagName("IMG"),b=0;b<a.length;b++)a[b].addEventListener("long-press",function(){var f,g,b=c("DIV"),d=this.src,e=["保存图片","关闭"];for(document.body.appendChild(b),css(b,{position:"fixed",top:"50%",left:"50%",width:"300px",height:"100px",marginLeft:"-150px",marginTop:"-75px",padding:"25px 0",textAlign:"center",background:"#F7F7F7"}),f=0;f<e.length;f++)g=c("A"),b.appendChild(g),css(g,{width:"250px",padding:"10px 0",fontSize:"16px",background:"#333333",color:"#FFFFFF",cursor:"pointer",display:"block",margin:"5px auto",textDecoration:"none"}),"保存图片"===e[f]?g.href=option.cdn+"/p/api/down/?u="+encodeURIComponent(d):"关闭"===e[f]&&g.addEventListener("mouseup",function(){var a=this.parentNode;document.body.removeChild(a)}),g.innerHTML=e[f]})}},cookie={set:function(a,b,c){var d=new Date;d.setDate(d.getDate()+c),document.cookie=a+"="+escape(b)+(null==c?"":";expires="+d.toGMTString())},get:function(a){return document.cookie.length>0&&(c_start=document.cookie.indexOf(a+"="),-1!=c_start)?(c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}},ajax={get:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.withCredentials=!0,b&&(c.onreadystatechange=function(){4!==c.readyState||200!==c.status&&304!==c.status||b.call(this,c.responseText)}),c.send()}},pwa={is:function(){return BE(window.navigator,"standalone")&&window.navigator.standalone},f:function(){if(pwa.is()){var a=cookie.get("mtfUrl"),b=cookie.get("mtfFirstRun");a&&!b&&(cookie.set("mtfRemove","mtfUrl"),setTimeout(function(){location.href=a},600)),cookie.set("mtfFirstRun","1")}},p:function(a){(pwa.is()||a)&&ajax.get(option.web+"/api.php?a=cookie&"+(a?a:"mtfUrl="+encodeURIComponent(location.href)))}};return{option:option,set:set,refresh:refresh,menu:menu,update:update,version:version,pm:pm,sign:sign,openWin:openWin,fc:fc,longTouch:longTouch,pwa:pwa}}();